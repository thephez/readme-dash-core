{
 "metadata": {
  "image": [],
  "title": "",
  "description": ""
 },
 "api": {
  "method": "get",
  "url": "",
  "auth": "required",
  "results": {
   "codes": [
    {
     "status": 200,
     "language": "json",
     "code": "{}",
     "name": ""
    },
    {
     "status": 400,
     "language": "json",
     "code": "{}",
     "name": ""
    }
   ]
  },
  "params": []
 },
 "next": {
  "description": "",
  "pages": [
   {
    "type": "doc",
    "icon": "file-text-o",
    "name": "Masternode Payment",
    "slug": "core-guide-dash-features-masternode-payment",
    "category": "Core Guides"
   }
  ]
 },
 "title": "Privatesend",
 "updates": [],
 "type": "basic",
 "slug": "core-guide-dash-features-privatesend",
 "excerpt": "",
 "body": "Dash Core's <<glossary:PrivateSend>> feature provides a way to improve privacy by performing coin-mixing without relinquishing custodial access. For additional details, reference this [Official Documentation PrivateSend page](https://docs.dash.org/en/stable/introduction/features.html#privatesend).\n\nThe following video provides an overview with a good introduction to the details:\n\n\n[block:embed]\n{\n  \"html\": false,\n  \"url\": \"https://www.youtube-nocookie.com/embed/vgCId3wJc5Y?rel=0\",\n  \"title\": \"How Dash's 'PrivateSend' Works Under the Hood - YouTube\",\n  \"favicon\": \"https://www.youtube-nocookie.com/favicon.ico\",\n  \"iframe\": true,\n  \"width\": \"100%\",\n  \"height\": \"350px\"\n}\n[/block]\n# PrivateSend Wallet Preparation\n\nThe <<glossary:wallet>> completes two operations in this phase:\n\n1. Split value into inputs matching the PrivateSend <<glossary:denominations>> by sending <<glossary:transactions>> to itself\n\n2. Split value into <<glossary:inputs>> to use for collateral by sending transactions to itself\n\n**Note**: Both these operations incur the standard <<glossary:transaction fee>> like any other transaction\n\n**Creating Denominations**\n\nThe PrivateSend denominations include a bit mapping to easily differentiate them. The [`dsa` message](core-ref-p2p-network-privatesend-messages#dsa) and [`dsq` message](core-ref-p2p-network-privatesend-messages#dsq) use this bit shifted integer instead of sending the actual denomination. The table below lists the bit, its associated integer value used in P2P messages, and the actual Dash value.\n\n| **Bit** | **Denom. (Integer)** | **Denomination (DASH)** |\n| --- | --- | --- |\n| 0   |  1 | 10.0001              |\n| 1   |  2 | 01.00001             |\n| 2   |  4 | 00.100001            |\n| 3   |  8 | 00.0100001           |\n| 4   | 16 | 00.00100001          |\n\nProtocol version 70213 added a 5th denomination (0.001 DASH).\n\n[Example Testnet denomination creation transaction](https://testnet-insight.dashevo.org/insight/tx/f0174fc87d68a18617c2990df4d9455c0459c601d2d6473934357a66f9b8b70a)\n\n**Creating Collaterals**\n\nPrivateSend collaterals are used to pay mixing fees, but are kept separate from the denominations to maximize privacy. Since protocol version 70213, the minimum collateral fee is 1/10 of the smallest denomination for all mixing sessions regardless of denomination. In Dash Core, collaterals are created with enough value to pay 4 collateral fees (4 x 0.001 DASH). ([Dash Core Reference](https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend.h#L459))\n\nIn protocol version 70208, collateral inputs can be anything from 2x the minimum collateral amount to the maximum collateral amount (currently defined as 4x the minimum collateral). In protocol versions > 70208, Dash Core can use any <<glossary:input>> from 1x the minimum collateral amount to the maximum collateral amount.\n\n[Example Testnet collateral creation transaction](https://testnet-insight.dashevo.org/insight/tx/8f9b15973983876f7ce4eb2c32b09690dfb0432d2caf6c6df516196a8d17689f)\n\n[Example Testnet collateral payment transaction](https://testnet-insight.dashevo.org/insight/tx/de51e6f7c5ef75aad0dbb0a808ef4873d7ef6d67b25f3a658d5a241db4f3eeeb)\n\n# PrivateSend Mixing\n\nThe mixing phase involves exchanging a sequence of messages with a <<glossary:masternode>> so it can construct a mixing transaction with inputs from the clients in its mixing pool.\n\n*PrivateSend Data Flow*\n\n|   | **Clients** | **Direction**  | **Masternode**   | **Description** |\n| --- | --- | :---: | --- | --- |\n| 0 | | | | Client determines whether to join an existing mixing pool or create a new one |\n| 1 | [`dsa` message](core-ref-p2p-network-privatesend-messages#dsa)                            | \u2192 |                            | Client asks to join mixing pool or have the masternode create a new one\n| 2 |                                                | \u2190 | [`dssu` message](core-ref-p2p-network-privatesend-messages#dssu)       | Masternode provides a mixing pool status update (Typical - State: `POOL_STATE_QUEUE`, Message: `MSG_NOERR`)\n| 3 |                                                | \u2190 | [`dsq` message](core-ref-p2p-network-privatesend-messages#dsq)        | Masternode notifies clients when it is ready to mix\n| 4 | [`dsi` message](core-ref-p2p-network-privatesend-messages#dsi)                                 | \u2192 |                       | Upon receiving a [`dsq` message](core-ref-p2p-network-privatesend-messages#dsq) with the Ready bit set, clients each provide a list of their inputs (unsigned) to be mixed, collateral, and a list of outputs where mixed funds should be sent\n| 5 |                                                | \u2190 | [`dssu` message](core-ref-p2p-network-privatesend-messages#dssu)       | Masternode provides a mixing pool status update (typical - State: `POOL_STATE_ACCEPTING_ENTRIES`, Message: `MSG_ENTRIES_ADDED`)\n| 6 |                                                | \u2190 | [`dsf` message](core-ref-p2p-network-privatesend-messages#dsf)        | Masternode sends the final transaction containing all clients inputs (unsigned) and all client outputs to each client for verification\n| 7 |                                                | \u2190 | [`dssu` message](core-ref-p2p-network-privatesend-messages#dssu)       | Masternode provides a mixing pool status update (Typical - State: `POOL_STATE_SIGNING`, Message: `MSG_NOERR`)\n| 8 | [`dss` message](core-ref-p2p-network-privatesend-messages#dss)                                 | \u2192 |                       | After verifying the final transaction, clients each sign their own inputs and send them back\n| 9 |                                                | \u2190 | [`dsc` message](core-ref-p2p-network-privatesend-messages#dsc)        | Masternode verifies the signed inputs, creates a [`dstx` message](core-ref-p2p-network-privatesend-messages#dstx) to broadcast the transaction, and notifies clients that the mixing transaction is complete (Typical - Message: `MSG_SUCCESS`)\n| 10 |                                                | \u2190 | [`inv` message](core-ref-p2p-network-data-messages#inv)        | Masternode broadcasts a `dstx` inventory message\n| 11 | [`getdata` message](core-ref-p2p-network-data-messages#getdata) (dstx)                                 | \u2192 |            | (Optional)\n\n**Additional notes**\n\n_**Step 0 - Pool Selection**_\n  * Existing mixing pool information is derived from the Queue messages seen by the client\n  * Dash Core attempts to join an existing mixing pool and only requests creation of a new one if that fails, although this is not a requirement that alternative implementations would be required to follow\n\n_**Step 1 - Pool Request**_\n\n  * The [`dsa` message](core-ref-p2p-network-privatesend-messages#dsa) contains a collateral transaction\n    * This transaction uses a collateral <<glossary:input>> created in the [Wallet Preparation](#privatesend-wallet-preparation) phase\n    * The collateral is a signed <<glossary:transaction>> that pays the collateral back to a client <<glossary:address>> minus a fee of 0.001 DASH\n\n_**Step 3 - Queue**_\n\n  * A masternode broadcasts [`dsq` messages](core-ref-p2p-network-privatesend-messages#dsq) when it starts a new queue. These message are relayed by all <<glossary:peers>>.\n  * As of protocol version 70214, mixing sessions have a variable number of participants defined by the range `nPoolMinParticipants` ([3](https://github.com/dashpay/dash/blob/v0.15.0.0/src/chainparams.cpp#L360)) to `nPoolMaxParticipants` ([5](https://github.com/dashpay/dash/blob/v0.15.0.0/src/chainparams.cpp#L361)). Prior protocol version mixing sessions always contained exactly 3 participants\n  * The masternode sends a [`dsq` message](core-ref-p2p-network-privatesend-messages#dsq) with the ready bit set once it has received valid [`dsa` messages](core-ref-p2p-network-privatesend-messages#dsa) from either:\n    1. The maximum number of clients (5)\n    2. Greater than the minimum number of clients (3) and the timeout has been reached ([30 seconds](https://github.com/dashpay/dash/blob/e9f7142ed01c0d7b53ef8b5f6f3f6375a68ef422/src/privatesend.h#L23))\n[block:callout]\n{\n  \"type\": \"warning\",\n  \"body\": \"Clients must respond to the Queue ready within 30 seconds or risk forfeiting the collateral they provided in the [`dsa` message](core-ref-p2p-network-privatesend-messages#dsa) (Step 1) ([Dash Core Reference](https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend.h#L23))\"\n}\n[/block]\n\n_**Step 4 - Inputs**_\n\n  * The collateral transaction can be the same in the [`dsi` message](core-ref-p2p-network-privatesend-messages#dsi) as the one in the [`dsa` message](core-ref-p2p-network-privatesend-messages#dsa) (Step 1) as long as it has not been spent\n  * Each client can provide up to 9 (`PRIVATESEND_ENTRY_MAX_SIZE`) inputs (and an equal number of outputs) to be mixed ([Dash Core Reference](https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend.h#L29))\n  * This is the only message in the PrivateSend process that contains enough information to link a wallet's PrivateSend inputs with its outputs\n    * This message is sent directly between a client and the mixing masternode (not relayed across the Dash network) so no other clients see it\n\n_**Step 6 - Final Transaction (unsigned)**_\n\n  * Once the masternode has received valid [`dsi` messages](core-ref-p2p-network-privatesend-messages#dsi) from all clients, it creates the final transaction and sends a [`dsf` message](core-ref-p2p-network-privatesend-messages#dsf)\n    * Inputs/outputs are ordered deterministically as defined by [BIP-69](https://github.com/dashevo/bips/blob/master/bip-0069.mediawiki#Abstract) to avoid leaking any data ([Dash Core Reference](https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend-server.cpp#L271-L272))\n    * Clients must sign their inputs to the Final Transaction within 15 seconds or risk forfeiting the collateral they provided in the [`dsi` message](core-ref-p2p-network-privatesend-messages#dsi) (Step 4) ([Dash Core Reference](https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend.h#L24))\n\n_**Step 10 - Final Transaction broadcast**_\n\n  * Prior to protocol version 70213, masternodes could only send a single un-mined [`dstx` message](core-ref-p2p-network-privatesend-messages#dstx) at a time. As of protocol version 70213, up to 5 (`MASTERNODE_MAX_MIXING_TXES`) un-mined [`dstx` messages](core-ref-p2p-network-privatesend-messages#dstx) per masternode are allowed. ([Dash Core Reference](https://github.com/dashpay/dash/blob/v0.15.0.0/src/masternode/masternode-meta.h#L16))\n\n_**General**_\n\n  With the exception of the [`dsq` message](core-ref-p2p-network-privatesend-messages#dsq) and the [`dstx` message](core-ref-p2p-network-privatesend-messages#dstx) (which need to be public and do not expose any private information), all PrivateSend P2P messages are sent directly between the mixing masternode and relevant client(s).\n\n# PrivateSend Fees\n\n**Mixing Fees**\n\n* If mixing completes successfully, Dash Core charges the collateral randomly in 1/10 mixing transactions to pay miners ([Dash Core Reference](https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend-server.cpp#L400-L417))\n* Clients that abuse the mixing system by failing to respond to [`dsq` messages](core-ref-p2p-network-privatesend-messages#dsq) or [`dsf` messages](core-ref-p2p-network-privatesend-messages#dsf) within the timeout periods may forfeit their collateral. Dash Core charges the abuse fee in 2/3 cases ([Dash Core Reference](https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend-server.cpp#L330-L347))\n\n**Sending Fees**\n\nTo maintain privacy when using PrivateSend, PrivateSend transactions must fully spend all inputs to a single output (with the remainder becoming the fee - i.e. no <<glossary:change output>>). This can result in large fees depending on the value being sent.\n\nFor example, an extreme case is sending the minimum non-dust value (546 duffs) via PrivateSend. This results in an extremely large transaction fee because the minimum PrivateSend denomination (0.0100001 DASH or 1,000,010 duffs) must be fully spent with no change. This results in a fee of 0.00999464 DASH and a sent value of only 0.00000546 DASH as shown by the calculation below.\n\n1000010 duffs (smallest PrivateSend denomination) - 546 duffs (value to send) = 999464 duffs (fee)\n\n[Example Testnet PrivateSend transaction spending 546 duffs](https://testnet-insight.dashevo.org/insight/address/yWWNYVEQ84RM1xXJekj62wJPF3h1TKh9fS)",
 "order": 2,
 "isReference": false,
 "hidden": false,
 "sync_unique": "",
 "link_url": "",
 "link_external": false,
 "pendingAlgoliaPublish": false,
 "createdAt": "2019-10-23T19:41:11.479Z",
 "updatedAt": "2020-05-28T20:35:31.120Z",
 "_id": "5e96055329a18c0025d39204",
 "version": "5e96055329a18c0025d39261",
 "project": "5daf2e65f4109c0040fd51e1",
 "user": "5af39863989da435b05d284d",
 "category": "5e96055329a18c0025d391e3",
 "__v": 3,
 "parentDoc": "5e96055329a18c0025d39201",
 "isApi": false,
 "id": "5e96055329a18c0025d39204",
 "body_html": "<div class=\"magic-block-textarea\"><p>Dash Core&#39;s &lt;&lt;glossary:PrivateSend&gt;&gt; feature provides a way to improve privacy by performing coin-mixing without relinquishing custodial access. For additional details, reference this <a href=\"https://docs.dash.org/en/stable/introduction/features.html#privatesend\">Official Documentation PrivateSend page</a>.</p>\n<p>The following video provides an overview with a good introduction to the details:</p>\n\n</div>\n<div class=\"magic-block-embed\">\n\t<iframe src=\"https://www.youtube-nocookie.com/embed/vgCId3wJc5Y?rel=0\" width=\"100%\" height=\"350px\" class=\"media-iframe\"></iframe>\n</div>\n<div class=\"magic-block-textarea\"><h1 class=\"header-scroll\"><div class=\"anchor waypoint\" id=\"section-private-send-wallet-preparation\"></div>PrivateSend Wallet Preparation<a class=\"fa fa-anchor\" href=\"#section-private-send-wallet-preparation\"></a></h1>\n<p>The &lt;&lt;glossary:wallet&gt;&gt; completes two operations in this phase:</p>\n<ol>\n<li  value=\"1\"><p>Split value into inputs matching the PrivateSend &lt;&lt;glossary:denominations&gt;&gt; by sending &lt;&lt;glossary:transactions&gt;&gt; to itself</p>\n</li><li  value=\"2\"><p>Split value into &lt;&lt;glossary:inputs&gt;&gt; to use for collateral by sending transactions to itself</p>\n</li></ol>\n<p><strong>Note</strong>: Both these operations incur the standard &lt;&lt;glossary:transaction fee&gt;&gt; like any other transaction</p>\n<p><strong>Creating Denominations</strong></p>\n<p>The PrivateSend denominations include a bit mapping to easily differentiate them. The <a href=\"core-ref-p2p-network-privatesend-messages#dsa\"><code>dsa</code> message</a> and <a href=\"core-ref-p2p-network-privatesend-messages#dsq\"><code>dsq</code> message</a> use this bit shifted integer instead of sending the actual denomination. The table below lists the bit, its associated integer value used in P2P messages, and the actual Dash value.</p>\n<div class=\"marked-table\"><table>\n<thead>\n<tr>\n<th><strong>Bit</strong></th>\n<th><strong>Denom. (Integer)</strong></th>\n<th><strong>Denomination (DASH)</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>1</td>\n<td>10.0001</td>\n</tr>\n<tr>\n<td>1</td>\n<td>2</td>\n<td>01.00001</td>\n</tr>\n<tr>\n<td>2</td>\n<td>4</td>\n<td>00.100001</td>\n</tr>\n<tr>\n<td>3</td>\n<td>8</td>\n<td>00.0100001</td>\n</tr>\n<tr>\n<td>4</td>\n<td>16</td>\n<td>00.00100001</td>\n</tr>\n</tbody>\n</table></div>\n<p>Protocol version 70213 added a 5th denomination (0.001 DASH).</p>\n<p><a href=\"https://testnet-insight.dashevo.org/insight/tx/f0174fc87d68a18617c2990df4d9455c0459c601d2d6473934357a66f9b8b70a\">Example Testnet denomination creation transaction</a></p>\n<p><strong>Creating Collaterals</strong></p>\n<p>PrivateSend collaterals are used to pay mixing fees, but are kept separate from the denominations to maximize privacy. Since protocol version 70213, the minimum collateral fee is 1/10 of the smallest denomination for all mixing sessions regardless of denomination. In Dash Core, collaterals are created with enough value to pay 4 collateral fees (4 x 0.001 DASH). (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend.h#L459\">Dash Core Reference</a>)</p>\n<p>In protocol version 70208, collateral inputs can be anything from 2x the minimum collateral amount to the maximum collateral amount (currently defined as 4x the minimum collateral). In protocol versions &gt; 70208, Dash Core can use any &lt;&lt;glossary:input&gt;&gt; from 1x the minimum collateral amount to the maximum collateral amount.</p>\n<p><a href=\"https://testnet-insight.dashevo.org/insight/tx/8f9b15973983876f7ce4eb2c32b09690dfb0432d2caf6c6df516196a8d17689f\">Example Testnet collateral creation transaction</a></p>\n<p><a href=\"https://testnet-insight.dashevo.org/insight/tx/de51e6f7c5ef75aad0dbb0a808ef4873d7ef6d67b25f3a658d5a241db4f3eeeb\">Example Testnet collateral payment transaction</a></p>\n<h1 class=\"header-scroll\"><div class=\"anchor waypoint\" id=\"section-private-send-mixing\"></div>PrivateSend Mixing<a class=\"fa fa-anchor\" href=\"#section-private-send-mixing\"></a></h1>\n<p>The mixing phase involves exchanging a sequence of messages with a &lt;&lt;glossary:masternode&gt;&gt; so it can construct a mixing transaction with inputs from the clients in its mixing pool.</p>\n<p><em>PrivateSend Data Flow</em></p>\n<div class=\"marked-table\"><table>\n<thead>\n<tr>\n<th></th>\n<th><strong>Clients</strong></th>\n<th style=\"text-align:center\"><strong>Direction</strong></th>\n<th><strong>Masternode</strong></th>\n<th><strong>Description</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td></td>\n<td style=\"text-align:center\"></td>\n<td></td>\n<td>Client determines whether to join an existing mixing pool or create a new one</td>\n</tr>\n<tr>\n<td>1</td>\n<td><a href=\"core-ref-p2p-network-privatesend-messages#dsa\"><code>dsa</code> message</a></td>\n<td style=\"text-align:center\">\u2192</td>\n<td></td>\n<td>Client asks to join mixing pool or have the masternode create a new one</td>\n</tr>\n<tr>\n<td>2</td>\n<td></td>\n<td style=\"text-align:center\">\u2190</td>\n<td><a href=\"core-ref-p2p-network-privatesend-messages#dssu\"><code>dssu</code> message</a></td>\n<td>Masternode provides a mixing pool status update (Typical - State: <code>POOL_STATE_QUEUE</code>, Message: <code>MSG_NOERR</code>)</td>\n</tr>\n<tr>\n<td>3</td>\n<td></td>\n<td style=\"text-align:center\">\u2190</td>\n<td><a href=\"core-ref-p2p-network-privatesend-messages#dsq\"><code>dsq</code> message</a></td>\n<td>Masternode notifies clients when it is ready to mix</td>\n</tr>\n<tr>\n<td>4</td>\n<td><a href=\"core-ref-p2p-network-privatesend-messages#dsi\"><code>dsi</code> message</a></td>\n<td style=\"text-align:center\">\u2192</td>\n<td></td>\n<td>Upon receiving a <a href=\"core-ref-p2p-network-privatesend-messages#dsq\"><code>dsq</code> message</a> with the Ready bit set, clients each provide a list of their inputs (unsigned) to be mixed, collateral, and a list of outputs where mixed funds should be sent</td>\n</tr>\n<tr>\n<td>5</td>\n<td></td>\n<td style=\"text-align:center\">\u2190</td>\n<td><a href=\"core-ref-p2p-network-privatesend-messages#dssu\"><code>dssu</code> message</a></td>\n<td>Masternode provides a mixing pool status update (typical - State: <code>POOL_STATE_ACCEPTING_ENTRIES</code>, Message: <code>MSG_ENTRIES_ADDED</code>)</td>\n</tr>\n<tr>\n<td>6</td>\n<td></td>\n<td style=\"text-align:center\">\u2190</td>\n<td><a href=\"core-ref-p2p-network-privatesend-messages#dsf\"><code>dsf</code> message</a></td>\n<td>Masternode sends the final transaction containing all clients inputs (unsigned) and all client outputs to each client for verification</td>\n</tr>\n<tr>\n<td>7</td>\n<td></td>\n<td style=\"text-align:center\">\u2190</td>\n<td><a href=\"core-ref-p2p-network-privatesend-messages#dssu\"><code>dssu</code> message</a></td>\n<td>Masternode provides a mixing pool status update (Typical - State: <code>POOL_STATE_SIGNING</code>, Message: <code>MSG_NOERR</code>)</td>\n</tr>\n<tr>\n<td>8</td>\n<td><a href=\"core-ref-p2p-network-privatesend-messages#dss\"><code>dss</code> message</a></td>\n<td style=\"text-align:center\">\u2192</td>\n<td></td>\n<td>After verifying the final transaction, clients each sign their own inputs and send them back</td>\n</tr>\n<tr>\n<td>9</td>\n<td></td>\n<td style=\"text-align:center\">\u2190</td>\n<td><a href=\"core-ref-p2p-network-privatesend-messages#dsc\"><code>dsc</code> message</a></td>\n<td>Masternode verifies the signed inputs, creates a <a href=\"core-ref-p2p-network-privatesend-messages#dstx\"><code>dstx</code> message</a> to broadcast the transaction, and notifies clients that the mixing transaction is complete (Typical - Message: <code>MSG_SUCCESS</code>)</td>\n</tr>\n<tr>\n<td>10</td>\n<td></td>\n<td style=\"text-align:center\">\u2190</td>\n<td><a href=\"core-ref-p2p-network-data-messages#inv\"><code>inv</code> message</a></td>\n<td>Masternode broadcasts a <code>dstx</code> inventory message</td>\n</tr>\n<tr>\n<td>11</td>\n<td><a href=\"core-ref-p2p-network-data-messages#getdata\"><code>getdata</code> message</a> (dstx)</td>\n<td style=\"text-align:center\">\u2192</td>\n<td></td>\n<td>(Optional)</td>\n</tr>\n</tbody>\n</table></div>\n<p><strong>Additional notes</strong></p>\n<p><em><strong>Step 0 - Pool Selection</strong></em></p>\n<ul>\n<li >Existing mixing pool information is derived from the Queue messages seen by the client</li><li >Dash Core attempts to join an existing mixing pool and only requests creation of a new one if that fails, although this is not a requirement that alternative implementations would be required to follow</li></ul>\n<p><em><strong>Step 1 - Pool Request</strong></em></p>\n<ul>\n<li >The <a href=\"core-ref-p2p-network-privatesend-messages#dsa\"><code>dsa</code> message</a> contains a collateral transaction<ul>\n<li >This transaction uses a collateral &lt;&lt;glossary:input&gt;&gt; created in the <a href=\"#privatesend-wallet-preparation\">Wallet Preparation</a> phase</li><li >The collateral is a signed &lt;&lt;glossary:transaction&gt;&gt; that pays the collateral back to a client &lt;&lt;glossary:address&gt;&gt; minus a fee of 0.001 DASH</li></ul>\n</li></ul>\n<p><em><strong>Step 3 - Queue</strong></em></p>\n<ul>\n<li >A masternode broadcasts <a href=\"core-ref-p2p-network-privatesend-messages#dsq\"><code>dsq</code> messages</a> when it starts a new queue. These message are relayed by all &lt;&lt;glossary:peers&gt;&gt;.</li><li >As of protocol version 70214, mixing sessions have a variable number of participants defined by the range <code>nPoolMinParticipants</code> (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/chainparams.cpp#L360\">3</a>) to <code>nPoolMaxParticipants</code> (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/chainparams.cpp#L361\">5</a>). Prior protocol version mixing sessions always contained exactly 3 participants</li><li >The masternode sends a <a href=\"core-ref-p2p-network-privatesend-messages#dsq\"><code>dsq</code> message</a> with the ready bit set once it has received valid <a href=\"core-ref-p2p-network-privatesend-messages#dsa\"><code>dsa</code> messages</a> from either:<ol>\n<li  value=\"1\">The maximum number of clients (5)</li><li  value=\"2\">Greater than the minimum number of clients (3) and the timeout has been reached (<a href=\"https://github.com/dashpay/dash/blob/e9f7142ed01c0d7b53ef8b5f6f3f6375a68ef422/src/privatesend.h#L23\">30 seconds</a>)</li></ol>\n</li></ul>\n\n</div>\n<div class=\"magic-block-callout type-warning no-title\"><span class=\"noTitleIcon\"><i title=\"Warning\" class=\"fa fa-exclamation-circle\"></i></span>\n\t<div class=\"callout-body\"><p>Clients must respond to the Queue ready within 30 seconds or risk forfeiting the collateral they provided in the <a href=\"core-ref-p2p-network-privatesend-messages#dsa\"><code>dsa</code> message</a> (Step 1) (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend.h#L23\">Dash Core Reference</a>)</p>\n\n\t</div>\n</div>\n<div class=\"magic-block-textarea\"><p><em><strong>Step 4 - Inputs</strong></em></p>\n<ul>\n<li >The collateral transaction can be the same in the <a href=\"core-ref-p2p-network-privatesend-messages#dsi\"><code>dsi</code> message</a> as the one in the <a href=\"core-ref-p2p-network-privatesend-messages#dsa\"><code>dsa</code> message</a> (Step 1) as long as it has not been spent</li><li >Each client can provide up to 9 (<code>PRIVATESEND_ENTRY_MAX_SIZE</code>) inputs (and an equal number of outputs) to be mixed (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend.h#L29\">Dash Core Reference</a>)</li><li >This is the only message in the PrivateSend process that contains enough information to link a wallet&#39;s PrivateSend inputs with its outputs<ul>\n<li >This message is sent directly between a client and the mixing masternode (not relayed across the Dash network) so no other clients see it</li></ul>\n</li></ul>\n<p><em><strong>Step 6 - Final Transaction (unsigned)</strong></em></p>\n<ul>\n<li >Once the masternode has received valid <a href=\"core-ref-p2p-network-privatesend-messages#dsi\"><code>dsi</code> messages</a> from all clients, it creates the final transaction and sends a <a href=\"core-ref-p2p-network-privatesend-messages#dsf\"><code>dsf</code> message</a><ul>\n<li >Inputs/outputs are ordered deterministically as defined by <a href=\"https://github.com/dashevo/bips/blob/master/bip-0069.mediawiki#Abstract\">BIP-69</a> to avoid leaking any data (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend-server.cpp#L271-L272\">Dash Core Reference</a>)</li><li >Clients must sign their inputs to the Final Transaction within 15 seconds or risk forfeiting the collateral they provided in the <a href=\"core-ref-p2p-network-privatesend-messages#dsi\"><code>dsi</code> message</a> (Step 4) (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend.h#L24\">Dash Core Reference</a>)</li></ul>\n</li></ul>\n<p><em><strong>Step 10 - Final Transaction broadcast</strong></em></p>\n<ul>\n<li >Prior to protocol version 70213, masternodes could only send a single un-mined <a href=\"core-ref-p2p-network-privatesend-messages#dstx\"><code>dstx</code> message</a> at a time. As of protocol version 70213, up to 5 (<code>MASTERNODE_MAX_MIXING_TXES</code>) un-mined <a href=\"core-ref-p2p-network-privatesend-messages#dstx\"><code>dstx</code> messages</a> per masternode are allowed. (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/masternode/masternode-meta.h#L16\">Dash Core Reference</a>)</li></ul>\n<p><em><strong>General</strong></em></p>\n<p>  With the exception of the <a href=\"core-ref-p2p-network-privatesend-messages#dsq\"><code>dsq</code> message</a> and the <a href=\"core-ref-p2p-network-privatesend-messages#dstx\"><code>dstx</code> message</a> (which need to be public and do not expose any private information), all PrivateSend P2P messages are sent directly between the mixing masternode and relevant client(s).</p>\n<h1 class=\"header-scroll\"><div class=\"anchor waypoint\" id=\"section-private-send-fees\"></div>PrivateSend Fees<a class=\"fa fa-anchor\" href=\"#section-private-send-fees\"></a></h1>\n<p><strong>Mixing Fees</strong></p>\n<ul>\n<li >If mixing completes successfully, Dash Core charges the collateral randomly in 1/10 mixing transactions to pay miners (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend-server.cpp#L400-L417\">Dash Core Reference</a>)</li><li >Clients that abuse the mixing system by failing to respond to <a href=\"core-ref-p2p-network-privatesend-messages#dsq\"><code>dsq</code> messages</a> or <a href=\"core-ref-p2p-network-privatesend-messages#dsf\"><code>dsf</code> messages</a> within the timeout periods may forfeit their collateral. Dash Core charges the abuse fee in 2/3 cases (<a href=\"https://github.com/dashpay/dash/blob/v0.15.0.0/src/privatesend/privatesend-server.cpp#L330-L347\">Dash Core Reference</a>)</li></ul>\n<p><strong>Sending Fees</strong></p>\n<p>To maintain privacy when using PrivateSend, PrivateSend transactions must fully spend all inputs to a single output (with the remainder becoming the fee - i.e. no &lt;&lt;glossary:change output&gt;&gt;). This can result in large fees depending on the value being sent.</p>\n<p>For example, an extreme case is sending the minimum non-dust value (546 duffs) via PrivateSend. This results in an extremely large transaction fee because the minimum PrivateSend denomination (0.0100001 DASH or 1,000,010 duffs) must be fully spent with no change. This results in a fee of 0.00999464 DASH and a sent value of only 0.00000546 DASH as shown by the calculation below.</p>\n<p>1000010 duffs (smallest PrivateSend denomination) - 546 duffs (value to send) = 999464 duffs (fee)</p>\n<p><a href=\"https://testnet-insight.dashevo.org/insight/address/yWWNYVEQ84RM1xXJekj62wJPF3h1TKh9fS\">Example Testnet PrivateSend transaction spending 546 duffs</a></p>\n\n</div>"
}